---
# tasks file for install-dependencies
- name: Ping my hosts
  ansible.builtin.ping:
- name: update packages
  apt:
      update_cache: yes
- name: install python3 and pip
  ansible.builtin.apt:
      name: 
         - python3
         - python3-pip
      state: present
- name: install python dependencies
  ansible.builtin.pip:
       name:
         -  pipreqs
       state: latest
- name: Scan user project and output requirements.txt file
  command: pipreqs {{ code_directory }} --force
  args:
    chdir: "{{ code_directory }}"
  register: pipreqs_output
  changed_when: "'Successfully saved requirements file' in pipreqs_output.stdout"
- name: check if requirements.txt file exists 
  stat:
    path: "{{ code_directory }}/requirements.txt"
  register: requirements
- name: install dependencies on requirements.txt
  pip:
    requirements: "{{ code_directory }}/requirements.txt"
  when: requirements.stat.exists
  

